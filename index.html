<!DOCTYPE html>
<html>
<head>
  <title>LFYSGA Emulator</title>   
  <style>
    body {
      background: #001010;
      color: silver;
      font-family: "Courier New", monospace;
      text-align: center;
    }
    textarea {
      width: 80%;
      height: 120px;
      background-color: black;
      color: #39FF14;
      font-family: "Courier New", monospace;
      font-size: 14px;
      margin-top: 10px;
    }
  </style>
  <link type="icon" href="img.gif">
  <link type="shortcut icon" href="img.gif">
</head>
<body>
  <canvas id="screen" width="256" height="256" style="border:1px solid black; background-color: #202f20;"></canvas><br><br>
  <img src="img.gif">
  <h2>Upload or Type Binary ROM</h2>
  <input type="file" id="in"><br><br>
  <textarea id="textbox" placeholder="Each line = 24-bit binary: opcode (8) + X (8) + Y (8)"></textarea><br>
  <button onclick="downloadROM()">Download Text</button>
  <div id="output"></div>

  <script>
    const canvas = document.getElementById("screen");
    const ctx = canvas.getContext("2d");

    function dp(x, y, color) {
      ctx.fillStyle = color;
      ctx.fillRect(x, y, 1, 1);
    }

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function runROM(data) {
      if (!data.trim()) return;
      clearCanvas();
      const lines = data.split(/\r?\n/).map(l => l.trim()).filter(l => l.length === 24);

      for (let line of lines) {
        const op = line.slice(0, 8);
        const x = parseInt(line.slice(8, 16), 2);
        const y = parseInt(line.slice(16, 24), 2);

        if (op === "11111111") {
          dp(x, y, "lime");
        } else if (op === "00000000") {
          dp(x, y, "#202f20"); // erase pixel
        }
        // You can expand with more 24-bit opcodes here
      }

      document.getElementById("output").innerHTML = "<pre>" + data + "</pre>";
    }

    document.getElementById("in").addEventListener("change", function () {
      const file = this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        const romData = e.target.result;
        document.getElementById("textbox").value = romData;
        runROM(romData);
      };
      reader.readAsText(file);
    });

    document.getElementById("textbox").addEventListener("input", function () {
      runROM(this.value);
    });

    function downloadROM() {
      const text = document.getElementById("textbox").value;
      const blob = new Blob([text], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "rom24bit.txt";
      a.click();
      URL.revokeObjectURL(a.href);
    }
  </script>
</body>
</html>
