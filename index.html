<!DOCTYPE html>
<html>
<head>
  <title>LFYSGA Emulator Online</title>   
  <style>
    body {
      background: #001010;
      color: silver;
      font-family: "Courier New", monospace;
      text-align: center;
    }
    textarea {
      width: 80%;
      height: 120px;
      background-color: black;
      color: #39FF14;
      font-family: "Courier New", monospace;
      font-size: 14px;
      margin-top: 10px;
    }
  </style>
  <link rel="shortcut icon" href="favicon.png" type="image/png">
  <link rel="icon" href="favicon.png" type="image/png">
</head>
<body>
  <canvas id="screen" width="256" height="256" style="border:1px solid black; background-color: #202f20;"></canvas><br>
  <br>
  <img src="img.gif" alt="Emulator Logo"><br><br>

  <h2>Choose or Upload a Binary ROM</h2>
  <select id="romSelect">
    <option value="">-- Select a ROM --</option>
    <option value="
1111111100100011
1111111100110100
1111111100010010">Draw 3 Green Pixels</option>
    <option value="
0000001100010001
0000001100100010">Add Examples</option>
    <option value="
0000000100110001
0000000100010010">Subtract Examples</option>
  </select><br><br>

  <input type="file" id="in"><br><br>
  <textarea id="textbox" placeholder="Or type your binary ROM here..."></textarea><br>
  <button onclick="downloadROM()">Download Text</button>
  <div id="output"></div>

  <script>
    const canvas = document.getElementById("screen");
    const ctx = canvas.getContext("2d");
    const pixelSize = 16;

    const dp = (x, y, color) => {
      ctx.fillStyle = color;
      ctx.fillRect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
    };

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function runROM(data) {
      if (!data.trim()) return;
      clearCanvas();
      let storage = [];

      const lines = data.split(/\r?\n/).map(line => line.trim()).filter(line => line.length >= 16);

      if (lines.length < 1) {
        document.getElementById("output").innerHTML = "ROM format is too short.";
        return;
      }

      for (const line of lines) {
        const func = line.slice(0, 8);
        const in1 = line.slice(8, 12);
        const in2 = line.slice(12);

        const i1 = parseInt(in1, 2);
        const i2 = parseInt(in2, 2);

        if (func === "11111111") {
          dp(i1, i2, "green");
        } else if (func === "00000011") {
          storage.push(i1 + i2);
        } else if (func === "00000001") {
          storage.push(i1 - i2);
        } else if (func === "00000000") {
          dp(i1, i2, "#202f20");
        } else if (func === "11111110") {
          dp(storage[i1] || 0, storage[i2] || 0, "green");
        }
      }

      document.getElementById("output").innerHTML = "<pre>" + data + "</pre>";
    }

    document.getElementById("in").addEventListener("change", function () {
      const file = this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        const romData = e.target.result;
        document.getElementById("textbox").value = romData;
        runROM(romData);
      };
      reader.readAsText(file);
    });

    document.getElementById("textbox").addEventListener("input", function () {
      runROM(this.value);
    });

    document.getElementById("romSelect").addEventListener("change", function () {
      const selectedROM = this.value;
      document.getElementById("textbox").value = selectedROM;
      runROM(selectedROM);
    });

    function downloadROM() {
      const text = document.getElementById("textbox").value;
      const blob = new Blob([text], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "rom.txt";
      a.click();
      URL.revokeObjectURL(a.href);
    }
  </script>

  <p>00000011 : add</p>
  <p>00000001 : sub</p>
  <p>11111111 : drw (draw pixel)</p>
  <p>11111110 : dws (draw from storage)</p>
</body>
</html>
